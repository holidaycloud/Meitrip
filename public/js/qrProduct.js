// Generated by CoffeeScript 1.8.0
(function() {
  $(function() {
    var addressID, addressList, cid, getAddress, priceID, startDate;
    priceID = $(".active").attr("data-price");
    cid = null;
    addressID = null;
    addressList = null;
    startDate = $(".active").attr("data-startDate");
    getAddress = function() {
      return $.ajax({
        type: "GET",
        url: "/ajax/address"
      }).done(function(data) {
        var address, i, str, _i, _len, _ref, _results;
        $("#address_list").html("");
        addressList = data.data;
        _ref = data.data;
        _results = [];
        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
          address = _ref[i];
          str = "<div class=\"radio\">\n    <label>\n        <input type=\"radio\" name=\"optionsRadios\" value=\"" + address._id + "\" " + (i === 0 ? "checked" : "") + ">\n        收货人:" + address.name + " " + address.phone + "<br/>\n        收货地址:" + address.showtext + "\n    </label>\n</div>";
          $("#address_list").append(str);
          if (i === 0) {
            $("#address-box").html("<span>\n    收货人:" + address.name + " " + address.phone + "\n</span>\n<br/>\n<span>\n    收货地址:" + address.showtext + "\n</span>");
          }
          if (i === 0) {
            _results.push(addressID = address._id);
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      });
    };
    if ($.cookie("lgi") === "1") {
      getAddress();
    }
    $("#btn_proDetail").click(function() {
      $("#main-box").addClass("hidden");
      return $("#content-box").removeClass("hidden");
    });
    $("#btn_contentReturn").click(function() {
      $("#content-box").addClass("hidden");
      return $("#main-box").removeClass("hidden");
    });
    $("#btn_addAddress").click(function() {
      if ($.cookie("lgi") === "1") {
        return $("#modal_address").modal("show");
      } else {
        return $("#myModal").modal("show");
      }
    });
    $("#btn_submitAdd").click(function() {
      return $.ajax({
        url: "/ajax/address/save",
        method: "POST",
        data: {
          province: $("#province").val(),
          city: $("#city").val(),
          district: $("#district").val(),
          address: $("#address").val(),
          name: $("#name").val(),
          phone: $("#phone").val(),
          isDefault: $("#isDefault").attr("checked") === "checked"
        }
      }).done(function(data) {
        var str;
        addressList.push(data);
        addressID = data._id;
        $("#address-box").html("<span>\n    收货人:" + data.name + " " + data.phone + "\n</span>\n<br/>\n<span>\n    收货地址:" + data.showtext + "\n</span>");
        str = "<div class=\"radio\">\n    <label>\n        <input type=\"radio\" name=\"optionsRadios\" value=\"" + data._id + "\" checked=\"checked\"}>\n        收货人:" + data.name + " " + data.phone + "<br/>\n        收货地址:" + data.showtext + "\n    </label>\n</div>";
        $("#address_list").append(str);
        return $("#modal_address").modal("hide");
      });
    });
    $("#address_list").on("change", "input:radio", function() {
      var addObj, address, _i, _len;
      addressID = $(this).val();
      addObj = null;
      for (_i = 0, _len = addressList.length; _i < _len; _i++) {
        address = addressList[_i];
        if (address._id === $(this).val()) {
          addObj = address;
        }
      }
      $("#address-box").html("<span>\n    收货人:" + addObj.name + " " + addObj.phone + "\n</span>\n<br/>\n<span>\n    收货地址:" + addObj.showtext + "\n</span>");
      return $("#modal_add_list").modal("hide");
    });
    $("#btn_changeAddress").click(function() {
      if ($.cookie("lgi") === "1") {
        return $("#modal_add_list").modal("show");
      } else {
        return $("#myModal").modal("show");
      }
    });
    $(".kind").click(function() {
      $(".kind").removeClass("active");
      $(this).addClass("active");
      priceID = $(this).attr("data-price");
      startDate = $(this).attr("data-startDate");
      return $.ajax({
        type: "GET",
        url: "/ajax/getPrice?id=" + priceID
      }).done(function(data) {
        var count, i, _i;
        $("#qty").html("");
        count = data.data.inventory <= 10 ? data.data.inventory : 10;
        for (i = _i = 1; 1 <= count ? _i <= count : _i >= count; i = 1 <= count ? ++_i : --_i) {
          $("#qty").append("<option value='" + i + "'>" + i + "</option>");
        }
        $("#price").text(data.data.price);
        $("#totalPrice").text(data.data.price * parseFloat($("#qty").val()));
        return $("#inventory_text").text(data.data.inventory);
      });
    });
    $("#qty").change(function() {
      return $("#totalPrice").text(parseFloat($("#price").text()) * parseFloat($(this).val()));
    });
    $("#logout").click(function() {
      return $.ajax({
        type: "POST",
        url: "/ajax/logout"
      }).done(function() {
        cid = null;
        $("#user_mobile").text("");
        return $(".user-box").addClass("hidden");
      });
    });
    $("#btn_buy").click(function() {
      if ($.cookie("lgi") !== "1") {
        return $("#myModal").modal("show");
      } else {
        $(this).attr("disabled", "disabled");
        return $.ajax({
          type: "POST",
          url: "/ajax/saveOrder",
          data: {
            startDate: startDate,
            quantity: $("#qty").val(),
            product: $("#btn_proDetail").attr("data-pid"),
            productName: $("#btn_proDetail").attr("data-pname"),
            contactName: $("#contact").val(),
            contactMobile: $("#contactMobile").val(),
            priceID: priceID,
            deliveryAddress: addressID
          }
        }).done(function(data) {
          console.log(data);
          if (data.error === 1) {
            return alert(data.errMsg);
          } else {
            return location.href = data.data;
          }
        });
      }
    });
    $("#btn_login").click(function() {
      return $.ajax({
        type: "POST",
        url: "/ajax/login",
        data: {
          mobile: $("#mobile").val(),
          passwd: faultylabs.MD5($("#passwd").val())
        }
      }).done(function(data) {
        if (data.error === 1) {
          return alert(data.errMsg);
        } else {
          cid = data.data._id;
          $("#user_mobile").text(data.data.mobile);
          $("#contact").val(data.data.name ? data.data.name : "");
          $("#contactMobile").val(data.data.mobile);
          $(".user-box").removeClass("hidden");
          $("#myModal").modal("hide");
          return getAddress();
        }
      });
    });
    $("#province").change(function() {
      $("#city").html("");
      $("#district").html("");
      return $.ajax({
        url: "/ajax/getCities",
        method: "GET",
        data: {
          pid: $(this).val()
        }
      }).done(function(msg) {
        var city, _i, _len, _ref, _results;
        $("#city").append("<option>- 请选择 -</option>");
        if (msg.error === 1) {
          return alert("网络异常");
        } else {
          _ref = msg.data;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            city = _ref[_i];
            _results.push($("#city").append("<option value='" + city.cid + "'>" + city.cityName + "</option>"));
          }
          return _results;
        }
      });
    });
    $("#city").change(function() {
      $("#district").html("");
      return $.ajax({
        url: "/ajax/getDistricts",
        method: "GET",
        data: {
          cid: $(this).val()
        }
      }).done(function(msg) {
        var district, _i, _len, _ref, _results;
        $("#district").append("<option>- 请选择 -</option>");
        if (msg.error === 1) {
          return alert("网络异常");
        } else {
          _ref = msg.data;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            district = _ref[_i];
            _results.push($("#district").append("<option value='" + district.did + "'>" + district.districtName + "</option>"));
          }
          return _results;
        }
      });
    });
    $("#btn_register").click(function() {
      $("#myModal").modal("hide");
      return $("#modal_reg").modal("show");
    });
    $("#btn_tologin").click(function() {
      $("#myModal").modal("show");
      return $("#modal_reg").modal("hide");
    });
    $("#btn_doregister").click(function() {
      var mobile, passwd, repasswd;
      mobile = $("#reg_mobile").val();
      passwd = $("#reg_passwd").val();
      repasswd = $("#reg_repasswd").val();
      if (passwd === repasswd) {
        return $.ajax({
          type: "POST",
          url: "/ajax/register",
          data: {
            mobile: mobile,
            passwd: faultylabs.MD5(passwd)
          }
        }).done(function(data) {
          if (data.error === 1) {
            return alert(data.errMsg);
          } else {
            cid = data.data._id;
            $("#user_mobile").text(data.data.mobile);
            $("#contact").val(data.data.name ? data.data.name : "");
            $("#contactMobile").val(data.data.mobile);
            $(".user-box").removeClass("hidden");
            $("#modal_reg").modal("hide");
            return getAddress();
          }
        });
      }
    });
  });

}).call(this);

//# sourceMappingURL=qrProduct.js.map
